<!DOCTYPE html>
<html>
  <head>
    <title>Place searches</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 90%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=places"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script>
var map;
var service;
var infowindow;

function initialize(lat,longt) {

	alert(lat);

	  var pyrmont = new google.maps.LatLng(-33.8665433,151.1956316);
	  //var pyrmont = new google.maps.LatLng(lat,longt);

	  map = new google.maps.Map(document.getElementById('map'), {
	      mapTypeId: google.maps.MapTypeId.ROADMAP,
	      center: pyrmont,
	      zoom: 15
	    });

	  var request = {
	    location: pyrmont,
	    radius: '500',
	    query: 'restaurant'
	  };

	  service = new google.maps.places.PlacesService(map);
	  service.textSearch(request, callback);
}


function callback(results, status) {
  if (status == google.maps.places.PlacesServiceStatus.OK) {
    for (var i = 0; i < results.length; i++) {
      var place = results[i];
      createMarker(results[i]);
    }
  }
}



function initialize2(lat,longt) {
  //var pyrmont = new google.maps.LatLng(-33.8665433, 151.1956316);
  var pyrmont = new google.maps.LatLng(lat,longt);

  map = new google.maps.Map(document.getElementById('map-canvas'), {
    center: pyrmont,
    zoom: 15
  });

  var request = {
    location: pyrmont,
    radius: 500,
    types: ['restaurant']
  };
  infowindow = new google.maps.InfoWindow();
  var service = new google.maps.places.PlacesService(map);
  service.nearbySearch(request, callback2);
}

function callback2(results, status) {
  if (status == google.maps.places.PlacesServiceStatus.OK) {
    for (var i = 0; i < results.length; i++) {
      createMarker(results[i]);
    }
  }
}

function createMarker(place) {
  var placeLoc = place.geometry.location;
  var marker = new google.maps.Marker({
    map: map,
    position: place.geometry.location
  });

  google.maps.event.addListener(marker, 'click', function() {
    infowindow.setContent(place.name);
    infowindow.open(map, this);
  });
}

//google.maps.event.addDomListener(window, 'load', initialize2);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
    <div id="map"></div>
    
    
    
    
    
    
    <div class="api-div" id="api-geolocation">
<h2>Geolocation</h2>
<style type="text/css">
#map_near {
	width: 280px; 
	height: 240px; 
	border: 2px solid #666;
 	display: block;
 	visibility: hidden; 
	margin: 1.0em auto; 
}
</style>
<div class="ui-block-b">
<div data-role="button" onclick="getCurrentPosition();">Get Current</div>
</div>
</div>

<div id="cur_position_near">&nbsp;</div>

<p><img id="map_near" /></p>
<script>var getCurrentPosition = function() {
    var success = function(pos) {                
        var text = "<div>Latitude: " + pos.coords.latitude + 
                    "<br/>" + "Longitude: " + pos.coords.longitude + "<br/>" + 
                    "Accuracy: " + pos.coords.accuracy + "m<br/>" + "</div>";
        $("#cur_position_near").html(text);
        console.log(text);
        
        var mapwidth = parseInt($('#map_near').css("width"), 10);  // remove 'px' from width value
        var mapheight = parseInt($('#map_near').css("height"), 10);
        $('#map_near').css('visibility','visible');
        
        $('#map_near').attr('src', "http://maps.googleapis.com/maps/api/staticmap?center=" + 
            pos.coords.latitude + "," + pos.coords.longitude + 
            "&zoom=13&size=" + mapwidth + "x" + mapheight + "&maptype=roadmap&markers=color:green%7C" +
            pos.coords.latitude + "," + pos.coords.longitude + "&sensor=false&key=AIzaSyB3WdAPmdVsmBW9MM9iZn-YDAxKiUy_E6U");

        initialize2(pos.coords.latitude,pos.coords.longitude);
        
        
    };
    var fail = function(error) {
        $("#cur_position_near").html("Error getting geolocation: " + error.code);
        console.log("Error getting geolocation: code=" + error.code + " message=" + error.message);
    };

    $('#map_near').css('visibility','hidden');
    $("#cur_position_near").html("Getting geolocation . . .");
    console.log("Getting geolocation . . .");
    navigator.geolocation.getCurrentPosition(success, fail);
};</script>
    

    
    
  </body>
</html>
